/*
* jQuery timepicker addon
* By: Trent Richardson [http://trentrichardson.com]
* Version 0.9.3
* Last Modified: 02/05/2011
* 
* Copyright 2010 Trent Richardson
* Dual licensed under the MIT and GPL licenses.
* http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
* http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
* 
* HERES THE CSS:
* .ui-timepicker-div .ui-widget-header{ margin-bottom: 8px; }
* .ui-timepicker-div dl{ text-align: left; }
* .ui-timepicker-div dl dt{ height: 25px; }
* .ui-timepicker-div dl dd{ margin: -25px 0 10px 65px; }
* .ui-timepicker-div td { font-size: 90%; }
*/(function($){function extendRemove(a,b){$.extend(a,b);for(var c in b)if(b[c]===null||b[c]===undefined)a[c]=b[c];return a}function Timepicker(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",ampm:!1,timeFormat:"hh:mm tt",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second"},this._defaults={showButtonPanel:!0,timeOnly:!1,showHour:!0,showMinute:!0,showSecond:!1,showTime:!0,stepHour:.05,stepMinute:.05,stepSecond:.05,hour:0,minute:0,second:0,hourMin:0,minuteMin:0,secondMin:0,hourMax:23,minuteMax:59,secondMax:59,minDateTime:null,maxDateTime:null,hourGrid:0,minuteGrid:0,secondGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,showTimepicker:!0},$.extend(this._defaults,this.regional[""])}$.extend($.ui,{timepicker:{version:"0.9.3"}}),$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,hour:0,minute:0,second:0,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",setDefaults:function(a){extendRemove(this._defaults,a||{});return this},_newInst:function($input,o){var tp_inst=new Timepicker,inlineSettings={};tp_inst.hour=tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second,tp_inst.ampm="",tp_inst.$input=$input;for(var attrName in this._defaults){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(a,b){$.isFunction(o.beforeShow)&&o.beforeShow(a,b,tp_inst)},onChangeMonthYear:function(a,b,c){tp_inst._updateDateTime(c),$.isFunction(o.onChangeMonthYear)&&o.onChangeMonthYear(a,b,c,tp_inst)},onClose:function(a,b){tp_inst.timeDefined===!0&&$input.val()!=""&&tp_inst._updateDateTime(b),$.isFunction(o.onClose)&&o.onClose(a,b,tp_inst)},timepicker:tp_inst}),o.altField&&(tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime()));return tp_inst},_addTimePicker:function(a){var b=this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(b),this._limitMinMaxDateTime(a,!1),this._injectTimePicker()},_parseTime:function(a,b){var c=(this._defaults.timeFormat+"").replace(/h{1,2}/ig,"(\\d?\\d)").replace(/m{1,2}/ig,"(\\d?\\d)").replace(/s{1,2}/ig,"(\\d?\\d)").replace(/t{1,2}/ig,"(am|pm|a|p)?").replace(/\s/g,"\\s?")+"$",d=this._getFormatPositions(),e;this.inst||(this.inst=$.datepicker._getInst(this.$input[0]));if(b||!this._defaults.timeOnly){var f=$.datepicker._get(this.inst,"dateFormat");c=".{"+f.length+",}"+this._defaults.separator+c}if(e=a.match(new RegExp(c,"i"))){d.t!==-1&&(this.ampm=(e[d.t]===undefined||e[d.t].length===0?"":e[d.t].charAt(0).toUpperCase()=="A"?"AM":"PM").toUpperCase()),d.h!==-1&&(this.ampm=="AM"&&e[d.h]=="12"?this.hour=0:this.ampm=="PM"&&e[d.h]!="12"?this.hour=(parseFloat(e[d.h])+12).toFixed(0):this.hour=Number(e[d.h])),d.m!==-1&&(this.minute=Number(e[d.m])),d.s!==-1&&(this.second=Number(e[d.s]));return!0}return!1},_getFormatPositions:function(){var a=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|t{1,2})/g),b={h:-1,m:-1,s:-1,t:-1};if(a)for(var c=0;c<a.length;c++)b[(a[c]+"").charAt(0)]==-1&&(b[(a[c]+"").charAt(0)]=c+1);return b},_injectTimePicker:function(){var a=this.inst.dpDiv,b=this._defaults,c=this,d=(b.hourMax-b.hourMax%b.stepHour).toFixed(0),e=(b.minuteMax-b.minuteMax%b.stepMinute).toFixed(0),f=(b.secondMax-b.secondMax%b.stepSecond).toFixed(0),g=(this.inst.id+"").replace(/([^A-Za-z0-9_])/g,"");if(a.find("div#ui-timepicker-div-"+g).length===0&&b.showTimepicker){var h=' style="display:none;"',i='<div class="ui-timepicker-div" id="ui-timepicker-div-'+g+'"><dl><dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+g+'"'+(b.showTime?"":h)+">"+b.timeText+'</dt><dd class="ui_tpicker_time" id="ui_tpicker_time_'+g+'"'+(b.showTime?"":h)+'></dd><dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+g+'"'+(b.showHour?"":h)+">"+b.hourText+"</dt>",j=0,k=0,l=0,m;if(b.showHour&&b.hourGrid>0){i+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+g+'"'+(b.showHour?"":h)+'></div><div style="padding-left: 1px"><table><tr>';for(var n=b.hourMin;n<d;n+=b.hourGrid){++j;var o=b.ampm&&n>12?n-12:n;o<10&&(o="0"+o),b.ampm&&(n==0?o="12a":n<12?o+="a":o+="p"),i+="<td>"+o+"</td>"}i+="</tr></table></div></dd>"}else i+='<dd class="ui_tpicker_hour" id="ui_tpicker_hour_'+g+'"'+(b.showHour?"":h)+"></dd>";i+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+g+'"'+(b.showMinute?"":h)+">"+b.minuteText+"</dt>";if(b.showMinute&&b.minuteGrid>0){i+='<dd class="ui_tpicker_minute ui_tpicker_minute_'+b.minuteGrid+'"><div id="ui_tpicker_minute_'+g+'"'+(b.showMinute?"":h)+'></div><div style="padding-left: 1px"><table><tr>';for(var p=b.minuteMin;p<e;p+=b.minuteGrid)++k,i+="<td>"+(p<10?"0":"")+p+"</td>";i+="</tr></table></div></dd>"}else i+='<dd class="ui_tpicker_minute" id="ui_tpicker_minute_'+g+'"'+(b.showMinute?"":h)+"></dd>";i+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+g+'"'+(b.showSecond?"":h)+">"+b.secondText+"</dt>";if(b.showSecond&&b.secondGrid>0){i+='<dd class="ui_tpicker_second ui_tpicker_second_'+b.secondGrid+'"><div id="ui_tpicker_second_'+g+'"'+(b.showSecond?"":h)+'></div><div style="padding-left: 1px"><table><tr>';for(var q=b.secondMin;q<f;q+=b.secondGrid)++l,i+="<td>"+(q<10?"0":"")+q+"</td>";i+="</tr></table></div></dd>"}else i+='<dd class="ui_tpicker_second" id="ui_tpicker_second_'+g+'"'+(b.showSecond?"":h)+"></dd>";i+="</dl></div>",$tp=$(i),b.timeOnly===!0&&($tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+b.timeOnlyTitle+"</div></div>"),a.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),this.hour_slider=$tp.find("#ui_tpicker_hour_"+g).slider({orientation:"horizontal",value:this.hour,min:b.hourMin,max:d,step:b.stepHour,slide:function(a,b){c.hour_slider.slider("option","value",b.value),c._onTimeChange()}}),this.minute_slider=$tp.find("#ui_tpicker_minute_"+g).slider({orientation:"horizontal",value:this.minute,min:b.minuteMin,max:e,step:b.stepMinute,slide:function(a,b){c.minute_slider.slider("option","value",b.value),c._onTimeChange()}}),this.second_slider=$tp.find("#ui_tpicker_second_"+g).slider({orientation:"horizontal",value:this.second,min:b.secondMin,max:f,step:b.stepSecond,slide:function(a,b){c.second_slider.slider("option","value",b.value),c._onTimeChange()}}),b.showHour&&b.hourGrid>0&&(m=100*j*b.hourGrid/(d-b.hourMin),$tp.find(".ui_tpicker_hour table").css({width:m+"%",marginLeft:m/(-2*j)+"%",borderCollapse:"collapse"}).find("td").each(function(a){$(this).click(function(){var a=$(this).html();if(b.ampm){var d=a.substring(2).toLowerCase(),e=parseInt(a.substring(0,2));d=="a"?e==12?a=0:a=e:e==12?a=12:a=e+12}c.hour_slider.slider("option","value",a),c._onTimeChange()}).css({cursor:"pointer",width:100/j+"%",textAlign:"center",overflow:"hidden"})})),b.showMinute&&b.minuteGrid>0&&(m=100*k*b.minuteGrid/(e-b.minuteMin),$tp.find(".ui_tpicker_minute table").css({width:m+"%",marginLeft:m/(-2*k)+"%",borderCollapse:"collapse"}).find("td").each(function(a){$(this).click(function(){c.minute_slider.slider("option","value",$(this).html()),c._onTimeChange()}).css({cursor:"pointer",width:100/k+"%",textAlign:"center",overflow:"hidden"})})),b.showSecond&&b.secondGrid>0&&$tp.find(".ui_tpicker_second table").css({width:m+"%",marginLeft:m/(-2*l)+"%",borderCollapse:"collapse"}).find("td").each(function(a){$(this).click(function(){c.second_slider.slider("option","value",$(this).html()),c._onTimeChange()}).css({cursor:"pointer",width:100/l+"%",textAlign:"center",overflow:"hidden"})});var r=a.find(".ui-datepicker-buttonpane");r.length?r.before($tp):a.append($tp),this.$timeObj=$("#ui_tpicker_time_"+g);if(this.inst!==null){var s=this.timeDefined;this._onTimeChange(),this.timeDefined=s}var t=c._defaults.onSelect;if(t){var u=c.$input?c.$input[0]:null,v=function(){t.apply(u,[c.formattedDateTime,c])};this.hour_slider.bind("slidestop",v),this.minute_slider.bind("slidestop",v),this.second_slider.bind("slidestop",v)}}},_limitMinMaxDateTime:function(a,b){var c=this._defaults,d=new Date(a.selectedYear,a.selectedMonth,a.selectedDay),e=new Date(a.selectedYear,a.selectedMonth,a.selectedDay,this.hour,this.minute,this.second,0);if(this._defaults.minDateTime!==null&&d){var f=this._defaults.minDateTime,g=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null)this.hourMinOriginal=c.hourMin,this.minuteMinOriginal=c.minuteMin,this.secondMinOriginal=c.secondMin;g.getTime()==d.getTime()?(this._defaults.hourMin=f.getHours(),this._defaults.minuteMin=f.getMinutes(),this._defaults.secondMin=f.getSeconds(),this.hour<this._defaults.hourMin&&(this.hour=this._defaults.hourMin),this.minute<this._defaults.minuteMin&&(this.minute=this._defaults.minuteMin),this.second<this._defaults.secondMin&&(this.second=this._defaults.secondMin)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal)}if(this._defaults.maxDateTime!==null&&d){var h=this._defaults.maxDateTime,i=new Date(h.getFullYear(),h.getMonth(),h.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null)this.hourMaxOriginal=c.hourMax,this.minuteMaxOriginal=c.minuteMax,this.secondMaxOriginal=c.secondMax;i.getTime()==d.getTime()?(this._defaults.hourMax=h.getHours(),this._defaults.minuteMax=h.getMinutes(),this._defaults.secondMax=h.getSeconds(),this.hour>this._defaults.hourMax&&(this.hour=this._defaults.hourMax),this.minute>this._defaults.minuteMax&&(this.minute=this._defaults.minuteMax),this.second>this._defaults.secondMax&&(this.second=this._defaults.secondMax)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal)}b!==undefined&&b===!0&&(this.hour_slider.slider("option",{min:this._defaults.hourMin,max:this._defaults.hourMax}).slider("value",this.hour),this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:this._defaults.minuteMax}).slider("value",this.minute),this.second_slider.slider("option",{min:this._defaults.secondMin,max:this._defaults.secondMax}).slider("value",this.second))},_onTimeChange:function(){var a=this.hour_slider?this.hour_slider.slider("value"):!1,b=this.minute_slider?this.minute_slider.slider("value"):!1,c=this.second_slider?this.second_slider.slider("value"):!1;a!==!1&&(a=parseInt(a,10)),b!==!1&&(b=parseInt(b,10)),c!==!1&&(c=parseInt(c,10));var d=a<12?"AM":"PM",e=a!=this.hour||b!=this.minute||c!=this.second||this.ampm.length>0&&this.ampm!=d;e&&(a!==!1&&(this.hour=a),b!==!1&&(this.minute=b),c!==!1&&(this.second=c)),this._defaults.ampm&&(this.ampm=d),this._formatTime(),this.$timeObj&&this.$timeObj.text(this.formattedTime),this.timeDefined=!0,e&&this._updateDateTime()},_formatTime:function(a,b,c){c==undefined&&(c=this._defaults.ampm),a=a||{hour:this.hour,minute:this.minute,second:this.second,ampm:this.ampm};var d=b||this._defaults.timeFormat+"";if(c){var e=a.ampm=="AM"?a.hour:a.hour%12;e=Number(e)===0?12:e,d=(d+"").replace(/hh/g,(e<10?"0":"")+e).replace(/h/g,e).replace(/mm/g,(a.minute<10?"0":"")+a.minute).replace(/m/g,a.minute).replace(/ss/g,(a.second<10?"0":"")+a.second).replace(/s/g,a.second).replace(/TT/g,a.ampm.toUpperCase()).replace(/tt/g,a.ampm.toLowerCase()).replace(/T/g,a.ampm.charAt(0).toUpperCase()).replace(/t/g,a.ampm.charAt(0).toLowerCase())}else d=(d+"").replace(/hh/g,(a.hour<10?"0":"")+a.hour).replace(/h/g,a.hour).replace(/mm/g,(a.minute<10?"0":"")+a.minute).replace(/m/g,a.minute).replace(/ss/g,(a.second<10?"0":"")+a.second).replace(/s/g,a.second),d=$.trim(d.replace(/t/gi,""));if(arguments.length)return d;this.formattedTime=d},_updateDateTime:function(a){a=this.inst||a,dt=new Date(a.selectedYear,a.selectedMonth,a.selectedDay),dateFmt=$.datepicker._get(a,"dateFormat"),formatCfg=$.datepicker._getFormatConfig(a),timeAvailable=dt!==null&&this.timeDefined,this.formattedDate=$.datepicker.formatDate(dateFmt,dt===null?new Date:dt,formatCfg);var b=this.formattedDate;if(a.lastVal===undefined||(a.lastVal.length<=0||this.$input.val().length!==0))this._defaults.timeOnly===!0?b=this.formattedTime:this._defaults.timeOnly!==!0&&(this._defaults.alwaysSetTime||timeAvailable)&&(b+=this._defaults.separator+this.formattedTime),this.formattedDateTime=b,this._defaults.showTimepicker?this.$altInput&&this._defaults.altFieldTimeOnly===!0?(this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate)):this.$altInput?(this.$altInput.val(b),this.$input.val(b)):this.$input.val(b):this.$input.val(this.formattedDate),this.$input.trigger("change")}}),$.fn.extend({timepicker:function(a){a=a||{};var b=arguments;typeof a=="object"&&(b[0]=$.extend(a,{timeOnly:!0}));return $(this).each(function(){$.fn.datetimepicker.apply($(this),b)})},datetimepicker:function(a){a=a||{};var b=this,c=arguments;return typeof a=="string"?a=="getDate"?$.fn.datepicker.apply($(this[0]),c):this.each(function(){var a=$(this);a.datepicker.apply(a,c)}):this.each(function(){var b=$(this);b.datepicker($.timepicker._newInst(b,a)._defaults)})}}),$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(a,b){var c=this._getInst($(a)[0]),d=this._get(c,"timepicker");d?(d._limitMinMaxDateTime(c,!0),c.inline=c.stay_open=!0,this._base_selectDate(a,b+d._defaults.separator+d.formattedTime),c.inline=c.stay_open=!1,this._notifyChange(c),this._updateDatepicker(c)):this._base_selectDate(a,b)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(a){if(typeof a.stay_open!=="boolean"||a.stay_open===!1){this._base_updateDatepicker(a);var b=this._get(a,"timepicker");b&&b._addTimePicker(a)}},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(a){var b=$.datepicker._getInst(a.target),c=$.datepicker._get(b,"timepicker");if(c)if($.datepicker._get(b,"constrainInput")){var d=c._defaults.ampm,e=(c._defaults.timeFormat+"").replace(/[hms]/g,"").replace(/TT/g,d?"APM":"").replace(/T/g,d?"AP":"").replace(/tt/g,d?"apm":"").replace(/t/g,d?"ap":"")+" "+c._defaults.separator+$.datepicker._possibleChars($.datepicker._get(b,"dateFormat")),f=String.fromCharCode(a.charCode===undefined?a.keyCode:a.charCode);return a.ctrlKey||(f<" "||!e||e.indexOf(f)>-1)}return $.datepicker._base_doKeyPress(a)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(a){var b=$.datepicker._getInst(a.target),c=$.datepicker._get(b,"timepicker");if(c)if(c._defaults.timeOnly&&b.input.val()!=b.lastVal)try{$.datepicker._updateDatepicker(b)}catch(d){$.datepicker.log(d)}return $.datepicker._base_doKeyUp(a)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(a){this._base_gotoToday(a),this._setTime(this._getInst($(a)[0]),new Date)},$.datepicker._disableTimepickerDatepicker=function(a,b,c){var d=this._getInst(a),e=this._get(d,"timepicker");e&&(e._defaults.showTimepicker=!1,e._onTimeChange(),e._updateDateTime(d))},$.datepicker._enableTimepickerDatepicker=function(a,b,c){var d=this._getInst(a),e=this._get(d,"timepicker");e&&(e._defaults.showTimepicker=!0,e._onTimeChange(),e._updateDateTime(d))},$.datepicker._setTime=function(a,b){var c=this._get(a,"timepicker");if(c){var d=c._defaults,e=b?b.getHours():d.hour,f=b?b.getMinutes():d.minute,g=b?b.getSeconds():d.second;if(e<d.hourMin||e>d.hourMax||(f<d.minuteMin||f>d.minuteMax)||(g<d.secondMin||g>d.secondMax))e=d.hourMin,f=d.minuteMin,g=d.secondMin;c.hour_slider?c.hour_slider.slider("value",e):c.hour=e,c.minute_slider?c.minute_slider.slider("value",f):c.minute=f,c.second_slider?c.second_slider.slider("value",g):c.second=g,c._onTimeChange(),c._updateDateTime(a)}},$.datepicker._setTimeDatepicker=function(a,b,c){var d=this._getInst(a),e=this._get(d,"timepicker");if(e){this._setDateFromField(d);var f;b&&(typeof b=="string"?(e._parseTime(b,c),f=new Date,f.setHours(e.hour,e.minute,e.second)):f=new Date(b.getTime()),f+""=="Invalid Date"&&(f=undefined)),this._setTime(d,f)}},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(a,b){var c=this._getInst(a),d=b instanceof Date?new Date(b.getTime()):b;this._updateDatepicker(c),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(a,d,!0)},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(a,b){var c=this._getInst(a),d=this._get(c,"timepicker");if(d){this._setDateFromField(c,b);var e=this._getDate(c);e&&d._parseTime($(a).val(),!0)&&e.setHours(d.hour,d.minute,d.second);return e}return this._base_getDateDatepicker(a,b)},$.timepicker=new Timepicker,$.timepicker.version="0.9.3"})(jQuery)